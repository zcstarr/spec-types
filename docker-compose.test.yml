services:
  test-ts:
    image: node:22-slim
    volumes:
      - ./generated/packages/ts:/pkg:ro
      - ./test-open-rpc-spec-1.3.2.tgz:/tgz/test-open-rpc-spec-1.3.2.tgz:ro
    command:
      - sh
      - -c
      - |
        set -e
        cp -r /pkg /tmp/ts
        cp /tgz/test-open-rpc-spec-1.3.2.tgz /tmp/ts/
        cd /tmp/ts
        npm install --ignore-scripts 2>&1
        node -e "import('./index.js').then(m => console.log('TS OK:', Object.keys(m)))"

  test-go:
    image: golang:1.24
    volumes:
      - ./generated/packages/go:/pkg:ro
    command:
      - sh
      - -c
      - |
        set -e
        cp -r /pkg /tmp/go
        cd /tmp/go
        go build ./...
        echo "Go OK"

  test-py:
    image: python:3.12-slim
    volumes:
      - ./generated/packages/py:/pkg:ro
    command:
      - sh
      - -c
      - |
        set -e
        cp -r /pkg /tmp/py
        cd /tmp/py
        pip install . --quiet 2>&1
        python -c "from open_rpc_spec_types import v1_4, v1_3; print('Py OK')"

  test-rs:
    image: rust:1.83-slim
    volumes:
      - ./generated/packages/rs:/pkg:ro
    command:
      - sh
      - -c
      - |
        set -e
        cp -r /pkg /tmp/rs
        cd /tmp/rs
        cargo check 2>&1
        echo "Rust OK"
